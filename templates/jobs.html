{% extends "base.html" %}

{% block title %}Job Listings - SD Jobs Board{% endblock %}

{% block styles %}
<style>
    .jobs-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .jobs-header h2 {
        color: #2c3e50;
        font-size: 2rem;
    }

    .job-count {
        background-color: #3498db;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: bold;
    }

    .jobs-list {
        display: grid;
        gap: 1.5rem;
    }

    .job-card-link {
        text-decoration: none;
        color: inherit;
        display: block;
    }

    .job-card {
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: transform 0.3s, box-shadow 0.3s;
        cursor: pointer;
    }

    .job-card-link:hover .job-card {
        transform: translateY(-4px);
        box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }

    .job-title {
        color: #2c3e50;
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
    }

    .job-company {
        color: #3498db;
        font-size: 1.1rem;
        margin-bottom: 1rem;
    }

    .job-details {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
        color: #7f8c8d;
    }

    .job-detail-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .job-description {
        color: #555;
        line-height: 1.6;
        margin-bottom: 1rem;
    }

    .job-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1rem;
    }

    .job-tag {
        background-color: #ecf0f1;
        padding: 0.25rem 0.75rem;
        border-radius: 4px;
        font-size: 0.9rem;
        color: #555;
    }

    .no-jobs {
        text-align: center;
        padding: 3rem;
        background: white;
        border-radius: 8px;
        color: #7f8c8d;
    }

    .error-message {
        background-color: #e74c3c;
        color: white;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
    }

    .applied-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background-color: #27ae60;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        font-weight: bold;
        font-size: 0.9rem;
    }

    .apply-button {
        background-color: #3498db;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        font-size: 0.9rem;
        transition: background-color 0.3s;
    }

    .apply-button:hover {
        background-color: #2980b9;
    }

    .job-actions {
        margin-top: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }
</style>
{% endblock %}

{% block content %}
{% if error %}
    <div class="error-message">
        <strong>Error:</strong> {{ error }}
    </div>
{% endif %}

<div class="jobs-header">
    <h2>Available Positions</h2>
    <span class="job-count">{{ count }} Jobs</span>
</div>

{% if jobs %}
    <div class="jobs-list">
        {% for job in jobs %}
        <a href="/jobs/{{ job.id }}" class="job-card-link">
            <div class="job-card">
                <h3 class="job-title">{{ job.title or 'Untitled Position' }}</h3>

                {% if job.company %}
                <div class="job-company">{{ job.company }}</div>
                {% endif %}

                <div class="job-details">
                    {% if job.location %}
                    <div class="job-detail-item">
                        <span>üìç</span>
                        <span>{{ job.location }}</span>
                    </div>
                    {% endif %}

                    {% if job.job_type or job.type %}
                    <div class="job-detail-item">
                        <span>üíº</span>
                        <span>{{ job.job_type or job.type }}</span>
                    </div>
                    {% endif %}

                    {% if job.salary %}
                    <div class="job-detail-item">
                        <span>üí∞</span>
                        <span>{{ job.salary }}</span>
                    </div>
                    {% endif %}
                </div>

                {% if job.description %}
                <div class="job-description">
                    {{ job.description[:300] }}{% if job.description|length > 300 %}...{% endif %}
                </div>
                {% endif %}

                <div class="job-meta">
                    {% if job.id %}
                    <span class="job-tag">ID: {{ job.id }}</span>
                    {% endif %}

                    {% if job.posted_date or job.created_at %}
                    <span class="job-tag">Posted: {{ job.posted_date or job.created_at }}</span>
                    {% endif %}
                </div>

                <div class="job-actions">
                    <span class="applied-badge" id="badge-{{ job.id }}" style="display: none;">
                        ‚úì Applied
                    </span>
                    <button class="apply-button" id="btn-{{ job.id }}" onclick="event.preventDefault(); event.stopPropagation(); toggleApplied('{{ job.id }}');">
                        Mark as Applied
                    </button>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>
{% else %}
    <div class="no-jobs">
        <h3>No jobs available at the moment</h3>
        <p>Check back soon for new opportunities!</p>
    </div>
{% endif %}

<script>
    // Get applied jobs from localStorage
    function getAppliedJobs() {
        const stored = localStorage.getItem('appliedJobs');
        return stored ? JSON.parse(stored) : [];
    }

    // Save applied jobs to localStorage
    function saveAppliedJobs(jobs) {
        localStorage.setItem('appliedJobs', JSON.stringify(jobs));
    }

    // Toggle applied status for a job
    function toggleApplied(jobId) {
        let appliedJobs = getAppliedJobs();
        const index = appliedJobs.indexOf(jobId);

        if (index > -1) {
            // Remove from applied
            appliedJobs.splice(index, 1);
        } else {
            // Add to applied
            appliedJobs.push(jobId);
        }

        saveAppliedJobs(appliedJobs);
        updateJobUI(jobId);
    }

    // Update UI for a specific job
    function updateJobUI(jobId) {
        const appliedJobs = getAppliedJobs();
        const isApplied = appliedJobs.includes(jobId);
        const badge = document.getElementById('badge-' + jobId);
        const button = document.getElementById('btn-' + jobId);

        if (badge && button) {
            if (isApplied) {
                badge.style.display = 'inline-flex';
                button.style.display = 'none';
            } else {
                badge.style.display = 'none';
                button.style.display = 'inline-block';
            }
        }
    }

    // Initialize UI on page load
    document.addEventListener('DOMContentLoaded', function() {
        const appliedJobs = getAppliedJobs();
        appliedJobs.forEach(jobId => {
            updateJobUI(jobId);
        });
    });
</script>
{% endblock %}
